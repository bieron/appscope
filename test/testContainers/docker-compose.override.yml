version: '3.5'
services:
  interposed_func: &testRunnerOpts
    command: -s /opt/test-runner/bin/libscope.so
    volumes:
      - ./logs:/opt/test-runner/logs
      - ../../lib/linux/libscope.so:/opt/test-runner/bin/libscope.so
    privileged: true

  cribl: *testRunnerOpts
  nginx: *testRunnerOpts
  splunk: *testRunnerOpts
  elastic: *testRunnerOpts
  kafka: *testRunnerOpts

  tls:
    volumes:
      - ../../lib/linux/libscope.so:/opt/test-runner/bin/libscope.so
      - ../../bin/linux/ldscope:/usr/bin/ldscope
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  detect_proto:
    volumes:
      - ../../lib/linux/libscope.so:/opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  gogen:
    volumes:
      - ../../lib/linux/libscope.so:/usr/lib/libscope.so
      - ../../bin/linux/ldscope:/usr/bin/ldscope
    privileged: true

  go_2: &goUnsupportedOpts
    volumes:
      - ../../lib/linux/libscope.so:/usr/lib/libscope.so
      - ../../bin/linux/ldscope:/usr/bin/ldscope
      - ./logs/:/testlogs/
    command: /go/unsupported/test_go.sh
    privileged: true
    environment:
      - SCOPE_LOG_LEVEL=warning
      - SCOPE_LOG_DEST=file:///go/logs.txt
  go_3: *goUnsupportedOpts
  go_4: *goUnsupportedOpts
  go_5: *goUnsupportedOpts
  go_6: *goUnsupportedOpts
  go_7: *goUnsupportedOpts

  go_8: &goOpts
    volumes:
      - ../../lib/linux/libscope.so:/usr/lib/libscope.so
      - ../../bin/linux/ldscope:/usr/bin/ldscope
      - ./go/influx/db:/go/influx/db
    privileged: true
    command: /go/test_go.sh
  go_9: *goOpts
  go_10: *goOpts
  go_11: *goOpts
  go_12: *goOpts
  go_13: *goOpts
  go_14: *goOpts
  go_15: *goOpts
  go_16: *goOpts

  java6:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  java7:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  java8:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  java9:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  java10:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  java11:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  java12:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  java13:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  java14:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  oracle_java6:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true
  
  oracle_java7:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  oracle_java8:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  oracle_java9:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  oracle_java10:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  oracle_java11:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  oracle_java12:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  oracle_java13:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true

  oracle_java14:
    volumes:
      - type: bind
        source: ../../lib/linux/libscope.so
        target: /opt/test-runner/bin/libscope.so
    environment:
      - LD_PRELOAD=/opt/test-runner/bin/libscope.so
    privileged: true
