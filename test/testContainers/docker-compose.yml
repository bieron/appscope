version: '3.5'
services:
  interposed_func:
    build:
      context: .
      dockerfile: ./interposed_func/Dockerfile
    privileged: true

  cribl:
    build:
      context: .
      dockerfile: ./cribl/Dockerfile

  nginx:
    build:
      context: .
      dockerfile: ./nginx/Dockerfile

  splunk:
    build:
      context: .
      dockerfile: ./splunk/Dockerfile

    privileged: true

  elastic:
    build:
      context: .
      dockerfile: ./elastic/Dockerfile

  kafka:
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181'
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
      KAFKA_METRIC_REPORTERS: io.confluent.metrics.reporter.ConfluentMetricsReporter
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
      CONFLUENT_METRICS_REPORTER_BOOTSTRAP_SERVERS: broker:29092
      CONFLUENT_METRICS_REPORTER_ZOOKEEPER_CONNECT: zookeeper:2181
      CONFLUENT_METRICS_REPORTER_TOPIC_REPLICAS: 1
      CONFLUENT_METRICS_ENABLE: 'true'
      CONFLUENT_SUPPORT_CUSTOMER_ID: 'anonymous'
    build:
      context: .
      dockerfile: ./kafka/Dockerfile

  tls:
    build:
      context: tls

  detect_proto:
    build:
      context: detect_proto
    ports:
      - 6379:6379
      - 27017:27017

  gogen:
    build:
      context: gogen

  go_2:
    build:
      context: go
      args:
        GO_VERSION: '1.2.2'
        BASE_IMAGE: debian:jessie-slim
  go_3:
    build:
      context: go
      args:
        GO_VERSION: '1.3'
        BASE_IMAGE: debian:jessie-slim
  go_4:
    build:
      context: go
      args:
        GO_VERSION: '1.4'
        BASE_IMAGE: debian:jessie-slim
  go_5:
    build:
      context: go
      args:
        GO_VERSION: '1.5'
        BASE_IMAGE: debian:jessie-slim
  go_6:
    build:
      context: go
      args:
        GO_VERSION: '1.6'
        BASE_IMAGE: debian:jessie-slim
  go_7:
    build:
      context: go
      args:
        GO_VERSION: '1.7'
        BASE_IMAGE: debian:jessie-slim
  go_8:
    build:
      context: go
      args:
        GO_VERSION: '1.8'
        BASE_IMAGE: debian:jessie-slim
  go_9:
    build:
      context: go
      args:
        GO_VERSION: '1.9'
  go_10:
    build:
      context: go
      args:
        GO_VERSION: '1.10'
  go_11:
    build:
      context: go
      args:
        GO_VERSION: '1.11'
  go_12:
    build:
      context: go
      args:
        GO_VERSION: '1.12'
  go_13:
    build:
      context: go
      args:
        GO_VERSION: '1.13'
  go_14:
    build:
      context: go
      args:
        GO_VERSION: '1.14'
  go_15:
    build:
      context: go
      args:
        GO_VERSION: '1.15'
  go_16:
    build:
      context: go
      args:
        GO_VERSION: '1.16'

  java6:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:6
        TOMCAT_MAJOR_VERSION: 7
        TOMCAT_MINOR_VERSION: 7.0.10

  java7:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:7
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils

  java8:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:8
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils
  
  java9:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:9
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils

  java10:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:10
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils

  java11:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:11
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils
  
  java12:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:12
        DNLD_HEXDUMP: yum -y install util-linux

  java13:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:13
        DNLD_HEXDUMP: yum -y install util-linux

  java14:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:14
        DNLD_HEXDUMP: microdnf install util-linux

  oracle_java6:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle6
      args:
        TOMCAT_MAJOR_VERSION: 7
        TOMCAT_MINOR_VERSION: 7.0.10
        KEYTOOL: /usr/java/jre1.6.0_45/bin/keytool

  oracle_java7:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jre/jre-7u80-linux-x64.tar.gz

  oracle_java8:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jre/jre-8u251-linux-x64.tar.gz

  oracle_java9:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jre/jre-9.0.4_linux-x64_bin.tar.gz

  oracle_java10:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jre/jre-10.0.2_linux-x64_bin.tar.gz

  oracle_java11:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jdk/jdk-11.0.6_linux-x64_bin.tar.gz

  oracle_java12:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jdk/jdk-12.0.2_linux-x64_bin.tar.gz

  oracle_java13:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jdk/jdk-13.0.2_linux-x64_bin.tar.gz

  oracle_java14:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jdk/jdk-14.0.2_linux-x64_bin.tar.gz
