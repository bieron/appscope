version: '3.5'
services:
  interposed_func:
    image: jbieron/scopetest_interposed_func:0.1
    build:
      context: .
      dockerfile: ./interposed_func/Dockerfile
    privileged: true

  cribl:
    image: jbieron/scopetest_cribl:0.1
    build:
      context: .
      dockerfile: ./cribl/Dockerfile

  nginx:
    image: jbieron/scopetest_nginx:0.1
    build:
      context: .
      dockerfile: ./nginx/Dockerfile

  splunk:
    image: jbieron/scopetest_splunk:0.1
    build:
      context: .
      dockerfile: ./splunk/Dockerfile
    privileged: true

  elastic:
    image: jbieron/scopetest_elastic:0.1
    build:
      context: .
      dockerfile: ./elastic/Dockerfile

  kafka:
    image: jbieron/scopetest_kafka:0.1
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181'
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
      KAFKA_METRIC_REPORTERS: io.confluent.metrics.reporter.ConfluentMetricsReporter
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
      CONFLUENT_METRICS_REPORTER_BOOTSTRAP_SERVERS: broker:29092
      CONFLUENT_METRICS_REPORTER_ZOOKEEPER_CONNECT: zookeeper:2181
      CONFLUENT_METRICS_REPORTER_TOPIC_REPLICAS: 1
      CONFLUENT_METRICS_ENABLE: 'true'
      CONFLUENT_SUPPORT_CUSTOMER_ID: 'anonymous'
    build:
      context: .
      dockerfile: ./kafka/Dockerfile

  tls:
    image: jbieron/scopetest_tls:0.1
    build:
      context: tls

  detect_proto:
    image: jbieron/scopetest_detect_proto:0.1
    build:
      context: detect_proto

  gogen:
    image: jbieron/scopetest_gogen:0.1
    build:
      context: gogen

  go_2:
    image: jbieron/scopetest_go_2:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.2.2'
        # TODO potentially unify base image
        # go1.4 and older do not compile with ld from ubuntu:20.04 (complains that ld -r and -pie are mutually exclusive)
        # and go1.16 does not compile with ld from debian:jessie-slim
        # temporarily I decided to have unsupported use one image and the rest another, to not introduce another split
        BASE_IMAGE: debian:jessie-slim
  go_3:
    image: jbieron/scopetest_go_3:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.3'
        BASE_IMAGE: debian:jessie-slim
  go_4:
    image: jbieron/scopetest_go_4:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.4'
        BASE_IMAGE: debian:jessie-slim
  go_5:
    image: jbieron/scopetest_go_5:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.5'
        BASE_IMAGE: debian:jessie-slim
  go_6:
    image: jbieron/scopetest_go_6:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.6'
        BASE_IMAGE: debian:jessie-slim
  go_7:
    image: jbieron/scopetest_go_7:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.7'
        BASE_IMAGE: debian:jessie-slim
  go_8:
    image: jbieron/scopetest_go_8:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.8'
        BASE_IMAGE: debian:jessie-slim
  go_9:
    image: jbieron/scopetest_go_9:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.9'
  go_10:
    image: jbieron/scopetest_go_10:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.10'
  go_11:
    image: jbieron/scopetest_go_11:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.11'
  go_12:
    image: jbieron/scopetest_go_12:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.12'
  go_13:
    image: jbieron/scopetest_go_13:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.13'
  go_14:
    image: jbieron/scopetest_go_14:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.14'
  go_15:
    image: jbieron/scopetest_go_15:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.15'
  go_16:
    image: jbieron/scopetest_go_16:0.1
    build:
      context: go
      args:
        GO_VERSION: '1.16'

  java6:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:6
        TOMCAT_MAJOR_VERSION: 7
        TOMCAT_MINOR_VERSION: 7.0.10

  java7:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:7
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils

  java8:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:8
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils
  
  java9:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:9
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils

  java10:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:10
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils

  java11:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:11
        DNLD_HEXDUMP: apt-get -o Acquire::Check-Valid-Until=false update && apt-get install -y bsdmainutils
  
  java12:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:12
        DNLD_HEXDUMP: yum -y install util-linux

  java13:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:13
        DNLD_HEXDUMP: yum -y install util-linux

  java14:
    build:
      context: .
      dockerfile: ./java/Dockerfile
      args:
        JDK_IMAGE: openjdk:14
        DNLD_HEXDUMP: microdnf install util-linux

  oracle_java6:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle6
      args:
        TOMCAT_MAJOR_VERSION: 7
        TOMCAT_MINOR_VERSION: 7.0.10
        KEYTOOL: /usr/java/jre1.6.0_45/bin/keytool

  oracle_java7:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jre/jre-7u80-linux-x64.tar.gz

  oracle_java8:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jre/jre-8u251-linux-x64.tar.gz

  oracle_java9:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jre/jre-9.0.4_linux-x64_bin.tar.gz

  oracle_java10:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jre/jre-10.0.2_linux-x64_bin.tar.gz

  oracle_java11:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jdk/jdk-11.0.6_linux-x64_bin.tar.gz

  oracle_java12:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jdk/jdk-12.0.2_linux-x64_bin.tar.gz

  oracle_java13:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jdk/jdk-13.0.2_linux-x64_bin.tar.gz

  oracle_java14:
    build:
      context: .
      dockerfile: ./java/Dockerfile.oracle
      args:
        JRE_TGZ: jdk/jdk-14.0.2_linux-x64_bin.tar.gz
